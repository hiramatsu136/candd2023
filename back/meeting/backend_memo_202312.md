# 2023年度施策メモ

## 作成するもの
- 会議出欠管理画面のバックエンドアプリ  
  ※イメージとしては、2課スプレッドシートの出欠シートのようなもの
- フロントの仕様に応じて必要なAPIを定義  
- 最終的にはサーバアプリのDocker imageを成果物とする  
  （開発環境で動作すればOK、デプロイなどは考えなくてよい）

## チームメンバー・担当
仕様がもう少し固まってから担当決め実施予定  
- KO：取りまとめ・雑用（環境用意など）  
- SI：xxx  
- HA：xxx  
- MO：xxx  
- SA：xxx  

## システム構成
- 使用技術はPython/FastAPIとする  
- プラットフォームはコンテナ化する都合上Linuxとする  
- データ保存形式はSQLiteを使用する
  - FastAPI + SQLiteの組み合わせの有識者が居る（MO）  
    →Pythonからアクセスするサンプルを来月までに用意し、12月に説明してもらう ★MO  
    →展開・サンプル説明済み。今回の仕様を実現するにあたり、特に問題無さそうなのでSQLiteで確定  

## IF仕様
- IF仕様叩き台作成  
  フロント仕様は既にある程度仕様があるので、メールで展開してもらう  
  →内容を踏まえてIF作成しフロントに展開 ★KO  
  →展開済み。フロント側から変更依頼・質問等あれば随時対応する

## DBテーブル構成
- IF仕様案と同時にチーム内で検討ずみ。  
  →社員管理テーブルは持たず、出欠管理の単一テーブルにデータを積み上げる方式とする  
  →同一社員・同一月のリクエストが来たらUPDATE、それ以外はINSERT（いわゆるUPSERT）

## DB留意点
- 年月を文字列で扱っているので、もしorder byが正常に動作しないようならdatetimeに変更する必要あるかも  
  （半角文字のみ、かつ0埋めで桁数揃えているので大丈夫だとは思う）

## 開発環境接続手順展開  
- 10月に展開済み  
  →1月打ち合わせにて全員で接続確認予定  
  →メンバーが揃わなかった場合、日時を指定して個々で接続確認してもらう  
  ※接続先の作業用サーバは普段停止させているため、事前に日時をアナウンスして起動させておく必要あり

## 1月作業予定
- フロントTMと仕様の擦り合わせ  
  ※後日フロントのGitファイルを見たが、特定の社員の1年分の出欠を一括更新する可能性あり（IF仕様変更？）  
  その他用語の不整合（画面側では出欠をattend/attendanceとしている。バックエンドはpresence）など、  
  擦り合わせが必要な事項が既に出ている
- 役割分担（分担の前提となる作業抽出・分割を含む）
- 開発環境接続確認

## その他TODO・メモなど
- 今月～来月までにやること
  - 特に無し
  - 強いて言うなら、今後の作業の分割などについてぼんやりとでも考えておいていただけるとありがたいです  
  - フロントからIF仕様についてコメント来たら、メールで相談依頼するかも（その時は協力お願いします）

- DBアクセス方式説明・質疑メモ  
  - connectでDB作成してくれる件  
    →じゃあ運用としてDB作成する必要は無い？（API走らせれば初回に自動で諸々設定される？）  
    →その通り  
    →DB全体の設定について、文字コードやタイムゾーンなどは明示的に設定した方が良さそう  
    →connectに設定用の引数などが無いなら、別途設定用の処理を調べて叩くか、  
    運用として事前に設定入れておく必要あり（DB初期設定が必要になる）  
  - カーソル作成時に暗黙的にトランザクションがbeginされる想定でよい？  
    →よい（with内がトランザクションだという認識でよい）  
    →ロールバック時はwith内で明示的にrollback指示する必要ある？  
    →不要。そもそもwith内で明示的にcommitしないと更新内容は反映されないので、  
    普通に例外などでwithを抜ければロールバック相当の動作になるはず  
  - データがシンプルに積みあがっていき、過去データ削除などの仕様が無いが、DBの容量問題は大丈夫か？  
    →そもそもデータが少ないので気にする必要無し  
    ※社員1人あたり、1年で出欠12件なので、現実的にGByte単位まで増えることは無い
  - DBのデータはファイルの形で保持される、このファイルが消えたら終わりなのでバックアップ方針は考えた方がいい  
    →今考えているのは、コンテナのマウントポイント設定して、ファイルはローカル側でバックアップする  
    →バックアップ方式は未定（そこまで大袈裟なものでもないので、cronでバックアップフォルダにコピーする程度で良さそう？）  

